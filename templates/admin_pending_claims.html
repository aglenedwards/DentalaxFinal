{% extends 'admin_base.html' %}

{% block content %}
<div class="mb-3">
  <input type="text" id="sucheInput" class="form-control" placeholder="üîç Suchen nach Praxisname, Stadt, E-Mail ..." onkeyup="filterTabelle()">
</div>

<section class="py-4">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="h2 mb-0">Ausstehende Praxis√ºbernahme-Anfragen</h1>
      <a href="/admin/praxen" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-2"></i> Zur√ºck zu allen Praxen
      </a>
    </div>
    
    <div class="alert alert-info" role="alert">
      <div class="d-flex">
        <div class="me-3">
          <i class="fas fa-info-circle fa-2x"></i>
        </div>
        <div>
          <h4 class="alert-heading h5 mb-2">Wichtiger Hinweis</h4>
          <p class="mb-0">Diese Anfragen betreffen Praxis√ºbernahmen von bereits beanspruchten Eintr√§gen. Bitte pr√ºfe sorgf√§ltig die Legitimit√§t, bevor du eine Anfrage genehmigst.</p>
        </div>
      </div>
    </div>
    
    {% if pending_claims|length == 0 %}
      <div class="card border-0 shadow-sm rounded-4 my-4">
        <div class="card-body p-4 text-center">
          <i class="fas fa-check-circle text-success fa-3x mb-3"></i>
          <h3 class="h5">Keine ausstehenden Anfragen</h3>
          <p class="text-muted mb-0">Aktuell gibt es keine offenen Praxis√ºbernahme-Anfragen</p>
        </div>
      </div>
    {% else %}
      <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>Eingegangen</th>
              <th>Praxisname</th>
              <th>Angefordert von</th>
              <th>E-Mail</th>
              <th>Adresse</th>
              <th>Nachricht</th>
              <th>Status</th>
              <th>Aktionen</th>
            </tr>
          </thead>
          <tbody>
            {% for claim in pending_claims %}
            <tr>
              <td>{{ claim.datum }}</td>
              <td>{{ claim.praxisname }}</td>
              <td>{{ claim.vorname }} {{ claim.nachname }}</td>
              <td>{{ claim.email }}</td>
              <td>{{ claim.strasse }}, {{ claim.plz }} {{ claim.stadt }}</td>
              <td>{{ claim.nachricht if claim.nachricht else '‚Äì' }}</td>
              <td>
                <span class="badge {{ 'bg-warning' if claim.status == 'ausstehend' else 'bg-success' if claim.status == 'genehmigt' else 'bg-danger' }}">
                  {{ claim.status }}
                </span>
              </td>
              <td class="text-center">
                {% if claim.status == 'ausstehend' %}
                <a href="/admin/claims/genehmigen/{{ claim.email|urlencode }}/{{ claim.plz|urlencode }}/{{ claim.strasse|urlencode }}" 
                   class="btn btn-sm btn-success me-1" onclick="return confirm('Diese Anfrage wirklich genehmigen?');">
                  <i class="fas fa-check"></i> Genehmigen
                </a>
                <a href="/admin/claims/ablehnen/{{ claim.email|urlencode }}/{{ claim.plz|urlencode }}/{{ claim.strasse|urlencode }}" 
                   class="btn btn-sm btn-danger" onclick="return confirm('Diese Anfrage wirklich ablehnen?');">
                  <i class="fas fa-times"></i> Ablehnen
                </a>
                {% else %}
                <span class="text-muted">Keine Aktionen verf√ºgbar</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  </div>
</section>

<script>
function filterTabelle() {
  const input = document.getElementById("sucheInput");
  const filter = input.value.toLowerCase();
  const rows = document.querySelectorAll("tbody tr");

  rows.forEach(row => {
    const text = row.textContent.toLowerCase();
    row.style.display = text.includes(filter) ? "" : "none";
  });
}
</script>
{% endblock %}