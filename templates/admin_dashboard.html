{% extends 'admin_base.html' %}

{% block title %}Dashboard{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="row g-3 mb-4">
  <div class="col-6 col-md-3">
    <div class="stat-card">
      <div class="d-flex justify-content-between">
        <div>
          <div class="stat-value">{{ stats.total_praxen }}</div>
          <div class="stat-label">Praxen gesamt</div>
        </div>
        <div class="stat-icon bg-primary">
          <i class="fas fa-clinic-medical"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="stat-card">
      <div class="d-flex justify-content-between">
        <div>
          <div class="stat-value">{{ stats.premium_praxen }}</div>
          <div class="stat-label">Premium-Abos</div>
        </div>
        <div class="stat-icon bg-success">
          <i class="fas fa-crown"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="stat-card">
      <div class="d-flex justify-content-between">
        <div>
          <div class="stat-value">{{ stats.pending_claims }}</div>
          <div class="stat-label">Offene Claims</div>
        </div>
        <div class="stat-icon bg-warning">
          <i class="fas fa-user-clock"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="stat-card">
      <div class="d-flex justify-content-between">
        <div>
          <div class="stat-value">{{ stats.externe_jobs }}</div>
          <div class="stat-label">Externe Jobs</div>
        </div>
        <div class="stat-icon bg-info">
          <i class="fas fa-briefcase"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row g-4">
  <div class="col-lg-8">
    <div class="data-card">
      <div class="data-card-header">
        <h3><i class="fas fa-clinic-medical me-2 text-primary"></i>Neueste Praxen</h3>
        <a href="/admin/praxen" class="btn btn-sm btn-outline-secondary">Alle anzeigen</a>
      </div>
      <div class="data-card-body">
        <table class="table">
          <thead>
            <tr>
              <th>Praxis</th>
              <th>Stadt</th>
              <th>Paket</th>
              <th>Status</th>
              <th>Registriert</th>
            </tr>
          </thead>
          <tbody>
            {% for praxis in neueste_praxen %}
            <tr>
              <td>
                <strong>{{ praxis.name }}</strong>
                <br><small class="text-muted">{{ praxis.email }}</small>
              </td>
              <td>{{ praxis.plz }} {{ praxis.stadt }}</td>
              <td>
                {% if praxis.paket and praxis.paket.lower() == 'premiumplus' %}
                  <span class="badge badge-paket badge-premiumplus">PremiumPlus</span>
                {% elif praxis.paket and praxis.paket.lower() == 'premium' %}
                  <span class="badge badge-paket badge-premium">Premium</span>
                {% else %}
                  <span class="badge badge-paket badge-basic">Basis</span>
                {% endif %}
              </td>
              <td>
                {% if praxis.ist_verifiziert %}
                  <span class="status-dot active"></span>Verifiziert
                {% else %}
                  <span class="status-dot pending"></span>Ausstehend
                {% endif %}
              </td>
              <td>{{ praxis.erstelldatum.strftime('%d.%m.%Y') if praxis.erstelldatum else '-' }}</td>
            </tr>
            {% else %}
            <tr>
              <td colspan="5" class="text-center text-muted py-4">Keine Praxen vorhanden</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <div class="col-lg-4">
    <div class="data-card mb-4">
      <div class="data-card-header">
        <h3><i class="fas fa-user-check me-2 text-warning"></i>Offene Claims</h3>
        <a href="/admin/claims" class="btn btn-sm btn-outline-secondary">Alle</a>
      </div>
      <div class="data-card-body">
        <table class="table">
          <tbody>
            {% for claim in offene_claims %}
            <tr>
              <td>
                <strong>{{ claim.praxis_name }}</strong>
                <br><small class="text-muted">{{ claim.email }}</small>
              </td>
              <td class="text-end">
                <a href="/admin/claims" class="btn btn-sm btn-outline-primary">
                  <i class="fas fa-eye"></i>
                </a>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="2" class="text-center text-muted py-3">Keine offenen Claims</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="data-card">
      <div class="data-card-header">
        <h3><i class="fas fa-chart-bar me-2 text-info"></i>Pakete</h3>
      </div>
      <div class="data-card-body p-3">
        <div class="d-flex justify-content-between mb-2">
          <span>PremiumPlus</span>
          <strong>{{ stats.premiumplus_count }}</strong>
        </div>
        <div class="progress mb-3" style="height: 8px;">
          <div class="progress-bar" role="progressbar" style="width: {{ (stats.premiumplus_count / stats.total_praxen * 100) if stats.total_praxen > 0 else 0 }}%; background: linear-gradient(90deg, #2a8294, #35bfd6);"></div>
        </div>
        
        <div class="d-flex justify-content-between mb-2">
          <span>Premium</span>
          <strong>{{ stats.premium_count }}</strong>
        </div>
        <div class="progress mb-3" style="height: 8px;">
          <div class="progress-bar bg-success" role="progressbar" style="width: {{ (stats.premium_count / stats.total_praxen * 100) if stats.total_praxen > 0 else 0 }}%;"></div>
        </div>
        
        <div class="d-flex justify-content-between mb-2">
          <span>Basis</span>
          <strong>{{ stats.basic_count }}</strong>
        </div>
        <div class="progress" style="height: 8px;">
          <div class="progress-bar bg-secondary" role="progressbar" style="width: {{ (stats.basic_count / stats.total_praxen * 100) if stats.total_praxen > 0 else 0 }}%;"></div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
